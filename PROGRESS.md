# PROGRESS CHECKPOINT

Date: 2025-11-04
Branch: chore/add-certus-verify (working branch)

Summary
-------
This checkpoint captures the work completed so far on the data-first backend scaffolding.

Files added / changed (high level)
- infra/compose.yaml            -- Postgres + Redis + api placeholder
- infra/db/migrations/0001_initial.sql -- initial raw SQL schema
- infra/db/alembic.ini
- infra/db/alembic/env.py
- infra/db/alembic/versions/0001_initial.py
- Dockerfile
- Makefile
- scripts/run_migrations.sh
- apps/api/main.py             -- FastAPI health + /internal/symbols endpoint
- certus/db/models.py         -- SQLModel models
- certus/db/session.py        -- async SQLModel engine + get_session
- tests/test_api.py           -- in-memory sqlite tests for /healthz and symbols
- .github/workflows/ci.yml    -- CI workflow to run pytest
- scripts/action_check_apis.py (existing) -- CI API check utility

What is done
-------------
- Core SQLModel models added (Symbol, PriceBar, NewsEvent, Fundamental, Indicator, TrendScore, Alert).
- Async session and engine wired via `certus.db.session` using DATABASE_URL default.
- Alembic scaffold added and wired to use SQLModel.metadata; initial revision runs the raw SQL migration.
- FastAPI app updated to use SQLModel engine for `/healthz` and added `/internal/symbols` endpoint.
- Tests added that run with an in-memory sqlite+aiosqlite DB (keeps CI fast).
- CI workflow added to run pytest on push/PR.

What remains / next priorities
------------------------------
1. Run `make install` locally to install developer deps (sqlmodel, alembic, asyncpg).
2. Run migrations (Alembic preferred):
   - `alembic -c infra/db/alembic.ini upgrade head` or `make migrate`
3. Run tests: `pytest -q` (these use in-memory SQLite and should pass without Postgres).
4. (Optional) Run compose and integration tests against Postgres:
   - `make up` then `make migrate` then run an integration test that talks to Postgres.
5. Add more endpoints and a seed script to populate `symbols` for UI/dev testing.

Commands to pick up tomorrow
---------------------------
1) Pull the branch and open it locally (if not already):

```bash
git checkout chore/add-certus-verify || git fetch && git checkout -b chore/add-certus-verify origin/chore/add-certus-verify
git pull --ff-only
```

2) Install dev deps:

```bash
make install
```

3) Run migrations:

```bash
# preferred
alembic -c infra/db/alembic.ini upgrade head
# or
make migrate
```

4) Run tests locally:

```bash
pytest -q
```

5) Verify API (start app if not running):

```bash
# start the app locally
make api
# then
curl -s http://localhost:8000/healthz | jq .
curl -s http://localhost:8000/internal/symbols | jq .
```

Suggested short chat message to paste next time to resume
-------------------------------------------------------
Copy-paste this in chat tomorrow to pick up quickly:

```
Resume checkpoint: branch=chore/add-certus-verify, last saved 2025-11-04.
I ran `make install`. I need to run migrations and tests next. Current status: migrations NOT applied, tests NOT run locally.
Please run: `alembic -c infra/db/alembic.ini upgrade head` then `pytest -q` and report failures.
Also ensure `certus/db/models.py` and `apps/api/main.py` are used for autogenerate in Alembic.
```

If you want me to push a checkpoint branch or open a draft PR, say "push checkpoint" and give the branch name you prefer (or I will use `chore/checkpoint-YYYYMMDD`).

---
Generated by automated assistant to checkpoint workspace edits made on 2025-11-04.
